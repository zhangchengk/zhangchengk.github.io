---
title: 索引什么时候失效
date: 2023-07-27
category: 面试
---

InnoDB 引擎里面有两种索引类型，一种是主键索引、一种是普通索引。 InnoDB 用了 B+树的结构来存储索引数据。 当使用索引列进行数据查询的时候，最终会到主键索引树中查询对应的数据行进 行返回。 理论上来说，使用索引列查询，就能很好的提升查询效率，但是不规范的使用 会导致索引失效，从而无法发挥索引本身的价值。 导致索引失效的情况有很多：

在索引列上做运算，比如使用函数，Mysql 在生成执行计划的时候，它是根据统 计信息来判断是否要使用索引的。而在索引列上加函数运算，导致 Mysql 无法识别索引列，也就不会再走索引了。不过从 Mysql8 开始，增加了函数索引可以解决这个问题。

在一个由多列构成的组合索引中，需要按照`最左匹配法则`，也就是从索引的最左 列开始顺序检索，否则不会走索引。在组合索引中，索引的存储结构是按照索引列的顺序来存储的，因此在 sql 中也 需要按照这个顺序才能进行逐一匹配。否则 InnoDB 无法识别索引导致索引失效。

当索引列存在隐式转化的时候， 比如索引列是字符串类型，但是在 sql 查询中 没有使用引号。那么 Mysql 会自动进行类型转化，从而导致索引失效在索引列使用不等于号、 not 查询的时候，由于索引数据的检索效率非常低，因此 Mysql 引擎会判断不走 索引

使用 like 通配符匹配后缀%xxx 的时候，由于这种方式不符合索引的最左匹配原则， 所以也不会走索引。但是反过来，如果通配符匹配的是前缀 xxx%，符合最左匹配，也会走索引。

使用 or 连接查询的时候，or 语句前后没有同时使用索引，那么索引会失效。只 有 or 左右查询字段都是索引列的时候，才会生效。

除了这些场景以外，对于多表连接查询的场景中，连接顺序也会影响索引的使用。 

不过最终是否走索引，我们可以使用 explain 命令来查看 sql 的执行计划，然后 针对性的进行调优即可。